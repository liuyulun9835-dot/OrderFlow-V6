# 工程日志 — OrderFlow V6（2025-10-15）

> 本日志汇总截至 2025-10-15 的项目管理上下文、阶段进展、数据现状与方法、合并与校准方案，以及对 `orderflowV6_todo_v1.1` 的卡片化修订建议（保持原有内容，同时补充对齐文件格式的新增卡片）。

---

## 0) 项目管理 Context（可供 Agent 长期引用）

**项目名**：OrderFlow V6（向 V7 过渡的“双轨渐进”体系）

**核心方法论（简述）**：

* 核心方法论（一句话画像）：以市场微结构/订单流（Order Flow）为核心观测，结合状态空间模型（HMM/TVTP/HSMM）构建“市场结构—状态—执行”三层体系。上层用Validator v2约束可证伪性（单/多变量显著性 + 成本鲁棒 + 漂移监控），下层以AB 双源热切换管理从低/中频观测到高频状态源的升级。
* 当前现状：我们已完成 000–108 的工程卡片并在本地跑通最小闭环；ATAS 自定义 indicator 成功导出 JSON（Bar/Tick），Binance OHLCV 历史数据已就绪做低/中频观测。经过对“3 个月聚合 Bar vs 7 天真 Tick vs 1 天 L2”的数据精度/窗口讨论，最终确定Plan A（双轨渐进）：以 Binance 低/中频轨尽快形成可解释的状态机与验证闭环，同时连续滚动积累 ATAS Tick/L2，在“重叠窗”内完成 minute↔tick 的映射与校准，再以成本鲁棒与执行可达性为闸门，切换到高频状态源。
* 工程采用 **双轨渐进** 处理数据，以训练验证市场结构和状态的HMM/TVTP/HSMM模型：

  * **轨道 A（低/中频｜Binance 主）**：

    1. **A1 数据摄取**：Binance OHLCV（1m/可选 1s）+ aggTrades 历史包标准化（统一 bar 边界/时区）。
    2. **A2 特征工程**：minute 级聚合微结构影子（聚合版 CVD/主动量）、价量波动分位、VWAP 偏离、ATR 等；固化 *feature schema* 与版本。
    3. **A3 状态建模**：HMM/TVTP-HMM（把波动/失衡作 Z_t）形成“可解释状态机”（趋势/盘整/转场），仅做**观测与解释**，不承诺可交易性。
    4. **A4 验证闭环**：Validator v2（单/多变量显著性、**成本鲁棒 base/+50%/×2**、漂移监控）；形成 `state_report.md`。
    5. **A5 基线接入**：把轨 A 的状态接入执行层作为**基线状态源**，用于 AB 对照与后续热切换的回滚锚点。
  * **轨道 B（高频｜ATAS 主）**：

    1. **B1 连续抓取**：ATAS Tick（7 天滚动）+ 备用 L2（≈1 天）；日级归档（JSON→Parquet）、质量报表（笔数/缺口）。
    2. **B2 高频特征**：逐笔 CVD、订单不平衡、吸收/冰山、DOM 队列压力、冲击近似与成交流量；固化事件抽取规则。
    3. **B3 重叠窗校准**（≥7×24h）：

       * **映射**：Tick→minute 的同名特征做均值/方差对齐与漂移监控（PSI/KS），输出 `mapping_tick2bar.pkl`；
       * **置信度校准**：对状态概率做温度缩放/等值回归，输出 `calibration_profile.json`；
       * **停留分布**：若差异显著，采用 **HSMM** 设置最小驻留与黏性，降低抖动与伪切换。
    4. **B4 闸门检查**：

       * **可执行性**：简化排队成交率与冲击惩罚评估；
       * **成本鲁棒**：base/+50%/×2 三档均为正；
       * **分布健康**：关键特征漂移在阈值内；全部达标方可进入候选状态源。
    5. **B5 热切换**：执行层 **AB 双源热切换**——当 B 达标即切主；若退化/告警则自动回滚至 A；全程留存切换与回滚审计日志。
  * **节拍与产物**：每两周形成 `merge_and_calibration_report.md` 与 `validator_report.md`；数据与模型资产采用固定落盘路径与版本号（manifest），确保可复用与可追溯。

**Plan A / Plan B 定义与取舍**：

* **Plan A（双轨渐进）**：以 **Binance 低/中频**先跑起观测与验证闭环（轨 A），**同时**滚动积累 **ATAS Tick/L2**（轨 B）。在**重叠窗**完成 **minute↔tick 映射**、**置信度标定**、**停留分布校准（必要时 HSMM 黏性）**。当候选高频状态机通过**可执行性 + 成本鲁棒 + 分布健康**三道闸门后，以 **AB 双源热切换**替换执行层状态源。
* **Plan B（低频先行）**：放弃中频与微结构阶段性目标，专注低/中低频（7–20 天节奏）建模与验证，以快速产出“可解释曲线”；后续待高频数据积累充足，再整体迁回中频/高频。
* **为何选择 Plan A**：我们的“核心资产”是 **可迁移的系统 + 数据 + 校准器**（而非一时的模型或低频显著曲线）。Plan A 能持续沉淀跨粒度的映射与校准能力，统一验证口径，降低未来替换状态源的结构性成本；同时通过 **AB 双源热切换**管理升级/回滚风险。Plan B 虽然出结果快，但易形成“慢世界真理”，在切回中高频时重构成本高且存在先验偏置风险。

**当前现状（概况）**：

* 000–108 卡片工程化完成并本地可运行；
* ATAS 自定义 Indicator 可导出 JSON（Bar/Tick）；
* 已拉取 Binance OHLCV 历史作为低/中频观测地基；
* 明确了 ATAS 数据窗口与精度限制（Bar≤3 个月、Tick≤7 天、L2≈1 天），以及 Binance 历史包长期回溯的优势；
* 经讨论后确定 **Plan A（双轨渐进）** 为主线。

**项目最核心资产（必须持续沉淀/复用）**：

1. **可迁移的研究与验证系统**（数据→特征/标签→状态→验证→执行），尤其是 **Validator v2** 的统一口径与报告；
2. **数据与特征资产**（Binance 低/中频 + ATAS Tick/L2 的原始/衍生特征），以及跨粒度的 **对齐/校准器**（minute↔tick 映射、置信度标定、停留分布/HSMM 参数）；
3. **执行层 AB 双源热切换机制**（可控升级/可回滚）。

**阶段里程碑（“已完成”的事实）**：

* **A｜工程落地**：000–108 卡片在本地完成并跑通最小闭环（导出→落地→基础校验）。
* **B｜数据认知**：验证 ATAS 三种精度与时间窗口；确认 Binance 历史包可作为低/中频主干与回补来源。
* **C｜路线决策**：拍板 **Plan A**；确定后续围绕“重叠窗校准 + 成本鲁棒 + 热切换”的节奏推进。

**风险与选择理由**：

* **为何选 Plan A**：我们的“核心资产定义”是 **系统 + 数据 + 校准器**，而非一次性的模型或低频曲线。Plan A 能沉淀跨粒度的可复用能力（映射/校准/统一验证），降低未来替换状态源的成本与风险。
* **慢世界真理的误导**（认知风险）：低/中低频显著性常在微结构/执行层失效；若以低频单线推进，容易固化错误先验，迁移时成本陡增。
* **数据落差的双重风险**：

  1. **实现效果**：粒度/口径差引发系统性偏置，若无校准，低频 posterior 迁往高频易劣化；
  2. **工程复杂度**：双源合并、映射/校准、漂移监控、可执行性预检会提高 Task 难度与时间跨度（需要分区存储、重叠窗、版本化 manifest 与日报体系）。

**度量（项目“核心关注面板”）**：

| 关注维度    | 指标/度量            | 说明                         | 模块归属         | 重要性 |
| ------- | ---------------- | -------------------------- | ------------ | --- |
| 代码稳定性   | 重复错误闭环率          | 同类报错修复后 2 周内复发率            | 工程/基础设施      | 高   |
| 代码稳定性   | CI/本地自检通过率       | lint/单测/数据 schema 自检一次通过占比 | 工程/基础设施      | 中   |
| 数据质量    | 切片连续性/缺失率        | ATAS JSON 连续性、缺失分钟占比       | 数据获取         | 高   |
| 数据质量    | 时间对齐一致率          | Binance vs ATAS bar 边界一致率  | 数据合并/对齐      | 高   |
| 映射与校准   | 特征分布漂移（PSI/KS）   | 同名特征（Binance↔ATAS）在重叠窗的漂移  | 映射/校准        | 高   |
| 映射与校准   | 置信度校准（ECE/Brier） | 状态概率的校准质量                  | 映射/校准/状态     | 高   |
| 映射与校准   | 停留分布差异           | 状态持久性分布 KS/黏性对比            | 状态/校准        | 中高  |
| 验证/可交易性 | 成本鲁棒通过率          | base/+50%/×2 三档为正的比率       | Validator v2 | 高   |
| 验证/可交易性 | 事件可执行性           | 事件窗内可成交率与冲击近似              | 执行/评估        | 高   |
| 系统稳定性   | 数据管线端到端延迟        | 导出→落地→合并→特征 的延迟            | 流水线          | 中   |
| 系统稳定性   | 存储/IO 压力         | 日增量、压缩比、读写耗时               | 基础设施         | 中   |
| 文档/复用   | 报告完备度            | “合并与校准报告/验证报告”完整性          | 文档/治理        | 中   |

---

## 1) 目前进度（展开）

* **工程化（000–108）**：自定义 ATAS Indicator 在本地成功运行；导出策略包含 `latest.json + 切片`；基础校验通过。
* **数据拉通**：完成 ATAS Bar/Tick 测试导出；Binance OHLCV 历史数据已就绪。`aggTrades` 聚合进入计划。
* **尚未完成**：三源数据的**统一合并**与**持续增量更新**（分区/manifest/日报）尚未落地。
* **方法路线**：

  * **Plan A（双轨渐进）** = 低/中频（Binance）先跑闭环 + 高频（ATAS）滚动累积；
  * 在**重叠窗**完成 minute↔tick 映射、置信度与停留分布校准（必要时 HSMM 黏性）；
  * 通过 **成本鲁棒**与**可执行性**闸门后，以 **AB 双源热切换**把执行层状态源升级。
  * **选择理由**：保障工程进度与长期复用性兼得，避免“慢世界真理”锁死结构。

---

## 2) 情况说明（数据处理与获取的现状）

### 数据来源与角色

| 数据源                                  | 精度/窗口         | 选择理由               | 在项目中的作用                            | 重要程度(1–5) | 应用时序优先级(1–5) |
| ------------------------------------ | ------------- | ------------------ | ---------------------------------- | --------: | -----------: |
| ATAS Bar 聚合（1m/5m/秒/100–1000tick 聚合） | 非真 tick；≤3 个月 | 轻量稳定、与 ATAS 指标口径一致 | 观测层；与 Binance bar 对齐；早期验证 AMT 聚合特征 |         3 |            4 |
| ATAS 真 Tick                          | 真逐笔；≈7 天滚动    | 微结构“金标准”           | 高频状态机主源；为聚合因子提供真值校准                |         5 |            3 |
| ATAS L2（DOM/盘口队列）                    | ≈1 天          | 队列/冲击研究关键          | 执行可达性、冲击近似的高价值特征（后置启用）             |         4 |            2 |
| Binance OHLCV（1m/可选 1s）              | 长回溯；免费        | 低/中频主干；口径稳定        | 先跑闭环的地基；与 ATAS bar 对齐              |         4 |            5 |
| Binance aggTrades（逐笔聚合）              | 长回溯；免费        | 逐笔的轻量替代            | 低/中频轨补“微结构影子”，支撑映射/校准              |         4 |            4 |

### 技术要点（明确定义与动机）

* **双轨数据管线**：

  * 轨 A（低/中频）：Binance OHLCV + aggTrades → minute 特征（CVD（聚合）、VWAP 偏离、ATR、波动/量能分位）→ HMM/TVTP → Validator v2。
  * 轨 B（高频）：ATAS Tick/L2 → 逐笔/盘口特征 → 在**重叠窗**对齐/校准 → 通过闸门后替换状态源。
  * **动机**：让系统先活起来，同时沉淀跨粒度的映射/校准资产，为未来切换做准备。

* **重叠窗校准**：

  * 在两个数据源同时可用的时间段（≥ 7×24h）上完成：

    1. **minute↔tick 特征映射**与分布对齐（均值/方差，PSI/KS 监控）；
    2. **置信度标定**（温度缩放/等值回归）使状态概率可比；
    3. **停留分布校准**（若差异显著，用 **HSMM** 设最小驻留与黏性）。
  * **动机**：解决“慢世界显著—快世界执行落差”的结构错位。

* **AB 双源热切换**：

  * 执行层同时接入两套状态源（低/中频基线；高频候选），当候选源在**校准/鲁棒/可执行性**达标后切主；若退化则回滚到基线。
  * **动机**：降低升级风险，保证执行层的连续性与可追溯性。

---

## 3) 三类数据的获取方法（步骤 + 背后理由）

### A. 3 个月 ATAS Bar 聚合数据

1. **设置图表与时间段（≤3 个月）**：避免越窗导致导出空洞。→ *确保连续性*
2. **选择统一分辨率（1m/5m/秒/聚合tick）**：与项目 bar 边界/时区规范一致。→ *为跨源对齐做准备*
3. **加载导出型 Indicator**：在参数中勾选 POC/VAH/VAL/CVD 等字段。→ *字段集合可版本化，可复现*
4. **配置导出策略（latest + 切片）**：每 bar close 写切片，`latest.json` 提供实时快照。→ *便于增量消费与回放*
5. **导出 & 完整性校验**：生成连续性报告（缺失/重复/跳变）。→ *作为合并准入门槛*
6. **归档与元数据**：`symbol/resolution/date` 分区与字段摘要。→ *支持重算与审计*

### B. 7 天 ATAS 真 Tick

1. **连接真 Tick 数据源**：确认供应质量与逐笔完整性。→ *微结构真相可靠*
2. **Indicator 切换为 Tick 导出**：逐笔字段（价/量/方向/统计钩子）并控制 IO 频率。→ *平衡精度与资源*
3. **滚动窗口管理（7 天）**：保持近窗完整，超窗日打包（JSON→Parquet）。→ *既可训练也控存储*
4. **资源与压缩策略**：高 IOPS 目录、及时压缩与分区。→ *降低合并时 IO 压力*
5. **质量报表**：分钟笔数/零成交分钟/缺口监控与补抓。→ *即时发现断点*

### C. Binance 历史聚合（OHLCV + aggTrades→本地 CVD）

1. **范围与分区策略**：按月/日历史包批量下载。→ *绕开 REST 限速，保证完整性*
2. **OHLCV 落地**：统一 bar 边界/时区；作为低/中频主干。→ *对齐 ATAS Bar 的时间框*
3. **aggTrades 聚合与本地 CVD**：分钟聚合主动/被动买卖量并给出 CVD（聚合版）。→ *补“微结构影子”*
4. **一致性核验（与 ATAS Bar）**：对比均值/方差/极值/缺口并记录偏差。→ *形成映射/校准基线*
5. **持久化与元数据**：Parquet 分区与统计摘要。→ *便于后续自动化消费*

#### 三类数据：获取方法 & 理由对比表

| 类别                          | 获取方法要点                                        | 获取理由（动机）                                    |
| --------------------------- | --------------------------------------------- | ------------------------------------------- |
| ATAS Bar（≤3 个月）             | 统一分辨率；Indicator 字段版本化；latest+切片；连续性自检；分区归档    | 轻量稳定、与 ATAS 指标口径一致；快速形成观测层并与 Binance bar 对齐 |
| ATAS Tick（≈7 天）             | 真逐笔导出；滚动 7 天；高 IOPS 与压缩；质量报表与补抓               | 微结构真相；为校准与高频状态训练提供“金标准”                     |
| Binance 历史（OHLCV+aggTrades） | 历史包批量下载；分钟聚合主动量/CVD；与 ATAS Bar 对比；Parquet+元数据 | 长回溯、免费；低/中频主干；补微结构影子，支撑映射/校准与先跑闭环           |

---

## 4) 三类数据的合并方法（步骤 + 背后理由）

1. **统一时区与 bar 边界**：固定 UTC 与 bar close 规则（右闭左开）。→ *时间是主键，先钉死语义*
2. **建立“对齐索引表”**：以分钟粒度记录可用源、缺失掩码、质量标记。→ *声明式合并，降低脚本分散*
3. **minute↔tick 特征映射（重叠窗）**：从 Tick 聚合 minute 特征，与 Binance/ATAS Bar 同名因子做均值/方差校准；监控 PSI/KS 并标注不可合并段。→ *消解口径差，形成映射器*
4. **置信度/状态校准（重叠窗）**：温度缩放/等值回归校准状态概率；停留分布对比，不一致则切换 HSMM 并设置最小驻留。→ *把状态放回可比较空间*
5. **标签与事件对齐**：统一标签定义（未来 N 分钟收益/波动/突破），重叠窗内确保一致并记录偏差。→ *验证口径统一*
6. **来源优先级/降级策略**：ATAS Tick 聚合 > ATAS Bar > Binance 聚合；降级段写入元数据（来源/校准版本/原因）。→ *合并要可解释可追溯*
7. **成本鲁棒与可执行性预检**：在合并后特征上做简化执行评估（排队率/冲击近似），仅通过三档成本者进入 Validator v2。→ *把“可交易性”前置，减少后段返工*
8. **产物与报告**：

   * 数据产物：`features_lowfreq.parquet`、`features_hft.parquet`；模型资产：`mapping_tick2bar.pkl`、`calibration_profile.json`；
   * 报告：`merge_and_calibration_report.md`（一致率/漂移/残差/降级段与原因）。→ *标准化命名，便于自动化与审计*

---

## 5) 关于 `orderflowV6_todo_v1.1`：是否需要修改工程卡片？

**结论**：需要。保持原有内容不动，同时按现有文件格式新增/细化卡片，使数据获取（三源分卡）、数据合并（独立大模块）、运行治理（AB 热切换/日报/成本鲁棒）更清晰、可验收。

> **对齐文件格式的新增/修订卡片（示例草案）**
> 字段遵循：`模块｜标题｜目标｜输入｜输出｜关键步骤｜DoD（验收）｜负责人｜优先级｜依赖｜工时估算｜风险&缓解｜落盘路径｜QA/工具`

### 【新增】卡片 111（数据）— ATAS Bar 聚合获取（3 个月）

* **目标**：规范化导出流程（分辨率/字段/切片与 latest 并存/连续性自检/分区归档）。
* **输入**：ATAS 回放/历史；导出 Indicator 配置。
* **输出**：`data/raw/atas/bar/{symbol}/resolution={X}/date=YYYY-MM-DD/*.json`、`export_manifest.json`。
* **关键步骤**：

  1. 设定时间窗与分辨率；
  2. Indicator 字段版本化；
  3. 切片+latest 导出；
  4. 连续性自检并出报告；
  5. 分区与元数据写入（schema、字段摘要）。
* **DoD**：任意 3 天分区缺失率 <0.1%，schema 校验通过；manifest 完整。
* **负责人**：数据工程｜**优先级**：P0｜**依赖**：101,103｜**工时**：M｜**落盘**：`data/raw/atas/bar`。

### 【新增】卡片 112（数据）— ATAS 真 Tick 连续抓取（7 天滚动）

* **目标**：建立真逐笔滚动抓取与归档机制，保证近窗完整，超窗日打包压缩。
* **输入**：ATAS 实时/回放源；Tick 导出参数。
* **输出**：`data/raw/atas/tick/{symbol}/date=YYYY-MM-DD/*.json(.parquet)`、`tick_quality_report.md`。
* **关键步骤**：

  1. 逐笔字段清单与 IO 策略；
  2. 7 天滚动窗口与日打包；
  3. 质量报表（分钟笔数/零成交/缺口）与补抓；
  4. 压缩与分区；
  5. manifest 记录水位与版本。
* **DoD**：近 7 天无缺口；质量报表生成；打包与校验通过。
* **负责人**：数据工程｜**优先级**：P0｜**依赖**：101,102,103｜**工时**：M｜**落盘**：`data/raw/atas/tick`。

### 【新增】卡片 113（数据）— Binance 历史：OHLCV + aggTrades（本地 CVD）

* **目标**：以历史包批量拉取，统一 bar 边界/时区；分钟聚合主动量/CVD（聚合版）；与 ATAS Bar 做基础对齐对比。
* **输入**：Binance 历史包；下载清单。
* **输出**：`data/raw/exchange/{symbol}/kline_1m.parquet`、`data/raw/exchange/{symbol}/aggtrades_1m.parquet`、`exchange_manifest.json`。
* **关键步骤**：

  1. 历史包分段下载与去重；
  2. OHLCV 标准化；
  3. aggTrades→分钟聚合主动量/CVD；
  4. 与 ATAS Bar 的均值/方差/极值/缺口对比；
  5. 分区与元数据。
* **DoD**：对齐后缺失率 ≤0.1%；聚合 CVD 稳定；manifest 完整。
* **负责人**：数据工程｜**优先级**：P0｜**依赖**：104,107｜**工时**：M｜**落盘**：`data/raw/exchange`。

### 【新增】卡片 115（数据合并）— 对齐索引表

* **目标**：以分钟为粒度统一主键，记录可用源、缺失掩码、质量标记。
* **输入**：111/112/113 产出；会话日历。
* **输出**：`data/staged/alignment_index.parquet`。
* **关键步骤**：时区与 bar 边界统一；重复/空洞清理；质量字段定义。
* **DoD**：与三源 join 后主键唯一；空洞标注完整。
* **负责人**：数据工程｜**优先级**：P0｜**依赖**：106,107｜**工时**：S。

### 【新增】卡片 116（数据合并）— minute↔tick 映射与分布校准

* **目标**：建立同名特征的均值/方差对齐；监控 PSI/KS 并输出“不可合并段”。
* **输入**：ATAS Tick 聚合 minute；Binance/ATAS Bar 因子。
* **输出**：`mapping_tick2bar.pkl`、`distribution_shift_report.md`。
* **关键步骤**：重叠窗抽取；线性/分位映射；漂移阈值；段落标注。
* **DoD**：重叠窗 PSI 在阈值内；映射残差可控。
* **负责人**：量化研究｜**优先级**：P0｜**依赖**：115｜**工时**：M。

### 【新增】卡片 117（数据合并）— 置信度与停留分布校准（含 HSMM 黏性）

* **目标**：状态概率经温度缩放/等值回归校准；停留分布差异显著时应用 HSMM 最小驻留。
* **输入**：候选状态机输出；重叠窗样本。
* **输出**：`calibration_profile.json`、`staytime_ks_report.md`。
* **关键步骤**：校准集/验证集拆分；参数拟合；阈值与回滚策略。
* **DoD**：ECE/Brier 达标；黏性后抖动降低且滞后可接受。
* **负责人**：量化研究｜**优先级**：P0｜**依赖**：302,116｜**工时**：M。

### 【新增】卡片 118（数据合并）— 标签/事件对齐与来源优先级降级

* **目标**：统一标签定义（未来 N 分钟收益/波动/突破），制定“ATAS Tick > ATAS Bar > Binance”的降级规则并写入元数据。
* **输入**：对齐索引表与三源特征；标签配置。
* **输出**：`data/processed/features_lowfreq.parquet`、`data/processed/features_hft.parquet`、`merge_and_calibration_report.md`。
* **关键步骤**：标签一致性检查；降级段标注；合并后可执行性预检（排队率/冲击近似）。
* **DoD**：通过三档成本预检的样本才进入 Validator；报告完整。
* **负责人**：数据工程/量化｜**优先级**：P0｜**依赖**：115–117,105｜**工时**：M。

### 【新增】卡片 607（执行）— AB 双源热切换

* **目标**：在执行层同时接入低/中频基线与高频候选；达标后切主，退化自动回滚。
* **输入**：`state_inference` 两路输出；监控指标与阈值。
* **输出**：切换/回滚日志、`switch_policy.yaml`。
* **关键步骤**：切换条件（校准/鲁棒/可执行性）；回滚触发；审计记录。
* **DoD**：演练通过；切换与回滚可复现。
* **负责人**：策略开发｜**优先级**：P0｜**依赖**：305,406｜**工时**：S。

### 【新增】卡片 808（监控）— 数据质量与健康度日报

* **目标**：自动生成 `results/qc/date=YYYY-MM-DD/` 报告（连续性、缺失、漂移告警、存储/IO、延迟、报错闭环）。
* **输入**：对齐索引、合并结果、CI 日志。
* **输出**：`data_qc_report.md`、IM 告警。
* **关键步骤**：指标聚合、阈值、静默期与抑制；只推新增失败分区。
* **DoD**：日报稳定；异常可追踪。
* **负责人**：DevOps｜**优先级**：P1｜**依赖**：108,115–118｜**工时**：S。

### 【强化】卡片 405（验证）— 成本敏感性与鲁棒性（刚性门槛）

* **补充说明**：把三档成本的通过线作为**准入闸门**前置到数据合并后第一步的可执行性预检中（与 118 联动），不达标不入 Validator 主流程。

#### 总结：为何这样修改工程卡片

* **资产沉淀**：把“映射/校准/合并/热切换/日报”实体化为卡片与产物，成为跨版本可复用的核心能力；
* **风控前移**：在合并后即做可执行性与成本鲁棒预筛，避免后段返工；
* **可观测/可回滚**：AB 热切换 + 日报让升级可控、异常可见；
* **治理与协作**：统一命名与产物位置，降低沟通成本，便于代理/协作者执行。
